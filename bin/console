#!/bin/bash

# Usage: "bin/console build (debug|release)"
# Description: Compiles "main.c" in "/target/(debug|release)/main"
build() {
    local target="$1"
    if [[ "$target" = "debug" || "$target" = "release" ]]; then
        mkdir -p "./target/$target"
        gcc -o "./target/$target/main" "./src/main.c"
        echo "Build ($target) finished executing."
        exit 0
    else
        echo "Error."
        echo "Invalid or missing build target."
        exit 1
    fi
}

# Usage: "bin/console run"
# Description: Runs the last compiled "main.c" executable from "/target/(debug|release)/main"
run() {
    if [ ! -f "./target/debug/main" ]; then
        echo "Error."
        echo "Binary not found."
        exit 1
    fi
    "./target/debug/main"
    exit 0
}

# Usage: "bin/console check-requirements"
# Description: Executes the system requirements check
requirements_check() {
    if ! command -v gcc &> /dev/null; then
        echo -e " - GCC \xE2\x9C\x97"
    else
        echo -e " - GCC \xE2\x9C\x93"
    fi
    echo "Requirements check finished executing."
    exit 0
}

if [ "$1" = "build" ]; then
    build "$2"
elif [ "$1" = "run" ]; then
    run
elif [ "$1" = "check-requirements" ]; then
    requirements_check
fi

echo "Error."
echo "Command not found."
exit 1